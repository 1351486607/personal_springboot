## 统一审理、内部审理
这块单独考虑

---

## 问责模块对接（0324 left 0.5）
1. 嵌入页面；列表，操作列挂接问责url（0.8人天）
2. 问责模块权限（数据+功能）（1.5人天）

- 问责办理-代签收

/zjjd/form/45a22ce20ee471684d8c1e3fa284da4d/update?ajlb=wzxtwzxt&lx=
iframe-src：http://172.23.26.15:8088/wzxt/wzjlb?xtbs=zjjd&xtmc=zjjd&nohead=2&noleft=2&flag=clxt-djqs

权限字：jcw.pzxt.wzbl.dqs

操作列：
待签收的查询有问题，没有数据暂时没法看。

- 问责办理-待分配

/zjjd/form/a4c5481f699660ac2c10728006e3071a/update?ajlb=wzxtdfp&lx=
iframe-src：http://172.23.26.15:8088/wzxt/wzjlb?xtbs=zjjd&xtmc=zjjd&nohead=2&noleft=2&flag=labl-dfp

权限字：jcw.pzxt.wzbl.dfp

操作：详情、分配承办人
分配承办人操作打开窗口需要全遮罩


- 问责办理-办理中

/zjjd/form/3a28c2fa51fa04eb5de9bb0d4229cb9a/update?ajlb=wzxtblz&lx=
iframe-src：http://172.23.26.15:8088/wzxt/wzjlb?xtbs=zjjd&xtmc=zjjd&nohead=2&noleft=2&flag=labl-blz

权限字：jcw.pzxt.wzbl.blz

    办理中-待立案：
    操作：详情、申请立案、变更承办人
    申请立案、变更承办人 操作打开弹窗需要全遮罩

    办理中-审查调查中：
    操作：详情、办理、变更承办人
    办理、变更承办人 操作打开弹窗需要全遮罩

    办理中-审理退回补充/重新审查调查：
    操作：详情、重新审查调查、补充审查调查、变更承办人
    重新审查调查、补充审查调查、变更承办人 操作打开弹窗需要全遮罩

    办理中-形审退回
    暂无数据



- 问责办理-办理结束

/zjjd/form/cb5937e9e0315b7b888d97fa526db2b0/update?ajlb=wzxtbljs&lx=
iframe-src：http://172.23.26.15:8088/wzxt/wzjlb?xtbs=zjjd&xtmc=zjjd&nohead=2&noleft=2&flag=labl-bljs

权限字：jcw.pzxt.wzbl.bljs

操作：详情



一级权限字：
jcw.pzxt.wzbl.dqs | jcw.pzxt.wzbl.dfp | jcw.pzxt.wzbl.blz | jcw.pzxt.wzbl.bljs







---

## 调查措施审批（0324 left 1.5）
>审批通过sysid+bk方式
1. 业务系统审批配置及开关配置在办案库（0.8人天）
2. 调试审批，走通+联调（1人天）
3. 审批服务配置（0.5人天）

- sysid+bk，暂不支持区分走办案还是派驻审批流程



---
## 处置对接（0324 left 1.5）

### 接口相关开发
1. 梳理案管与派驻在对接处置的差异（涵盖字段、单值代码），搬运原先功能，在后面对接详情时保持一致性（1.5人天）

2. 推送信访数据（处置->派驻）（接口功能搬运0.3人天）

        代码位置
        办案：agxtApi

3. 推送办理阶段数据（派驻-处置）（接口功能搬运0.3人天）
    
        代码位置
        办案：agxt

4. 处置跟踪球，线索接收


>接口文档地址：
http://gitlab.thunisoft.com/jcw/jjjb/JJJB_DOC/tree/master/20_%E5%B7%A5%E7%A8%8B%E8%BF%87%E7%A8%8B/30_%E8%AE%BE%E8%AE%A1%E7%9B%B8%E5%85%B3/40_%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/%E5%8A%9E%E6%A1%88%E5%88%B0%E5%A4%84%E7%BD%AE%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3




### 核心代码

- 处置监听

```java
package com.thunisoft.jcw.pzxt.mq;

import org.apache.rocketmq.spring.annotation.RocketMQMessageListener;
import org.apache.rocketmq.spring.core.RocketMQListener;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Component;
import org.springframework.web.client.RestTemplate;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.thunisoft.jcw.pzxt.constant.MappingConstant;
import com.thunisoft.jcw.pzxt.model.TXfczxx;
import com.thunisoft.jcw.pzxt.service.IXfczxxService;
import com.thunisoft.jcw.pzxt.utils.MappingConvertUtils;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;

/**
 * @author sunwenhao
 * @date 2020/3/24 11:09
 */
@Component
@Slf4j
@RequiredArgsConstructor(onConstructor_ = @Autowired)
@RocketMQMessageListener(nameServer = "${rocketmq.nameServer}", topic = "${CzxtMq.receive.topic}", consumerGroup = "${CzxtMq.consumer.groupName}")
public class CzxtMqListener implements RocketMQListener<JSONObject> {

    private final RestTemplate restTemplate;

    private final IXfczxxService iXfczxxService;

    @Override
    public void onMessage(JSONObject jsonObject) {
        try {
            consumerMsg(jsonObject);
        } catch (Exception e) {
            log.error("处置推数办案异常", e);
        }
    }

    private void consumerMsg(JSONObject jsonObject) {
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(jsonObject.getString("url") + "?cBusinessNumber=" + jsonObject.getString("cBusinessNumber"), String.class);
        TXfczxx txfczxx = MappingConvertUtils.convert(JSON.parseObject(responseEntity.getBody()).getJSONObject("content"), MappingConstant.CZXT_TO_PZXT_MAP, TXfczxx.class);
        iXfczxxService.saveXfczxx(txfczxx);
    }
}

```
- 字段映射、单值代码映射

映射方法

```java
package com.thunisoft.jcw.pzxt.utils;

import java.util.Map;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.thunisoft.artery.data.annotation.ExceptionTips;

import lombok.experimental.UtilityClass;

/**
 * @author sunwenhao
 * @date 2020/3/24 17:25
 */
@UtilityClass
public class MappingConvertUtils {
    @ExceptionTips("字段映射转换异常")
    public <T> T convert(Object sourceObj, Map<String, String> map, Class<T> targetClazz) {
        JSONObject jsonObject = JSON.parseObject(JSON.toJSONString(sourceObj));
        if (jsonObject == null) {
            return null;
        }
        map.entrySet().forEach(m -> jsonObject.put(m.getValue(), jsonObject.get(m.getKey())));
        return jsonObject.toJavaObject(targetClazz);
    }
}

```

映射配置
```java
package com.thunisoft.jcw.pzxt.constant;

import java.util.Collections;
import java.util.HashMap;
import java.util.Map;

/**
 * @author sunwenhao
 * @date 2020/3/24 17:29
 */
public class MappingConstant {

    public static final Map<String, String> CZXT_TO_PZXT_MAP;

    static {
        HashMap<String, String> map = new HashMap<>();
        map.put("fjxxList", "cXfczFjxx");
        map.put("flxx", "cXfczFjxx");
        map.put("xfxx", "cXfczXfxx");
        map.put("xfbjbrList", "cXfczXfbjbr");
        map.put("xffywtList", "cXfczXffywt");
        map.put("xfblList", "cXfczXfbl");
        map.put("xfjbrList", "cXfczXfjbr");
        CZXT_TO_PZXT_MAP = Collections.unmodifiableMap(map);
    }

    public static final Map<String, String> XFCZXX_TO_XFXX_MAP;

    static {
        HashMap<String, String> map = new HashMap<>();
        map.put("fjxxList", "cXfczFjxx");
        map.put("flxx", "cXfczFjxx");
        map.put("xfxx", "cXfczXfxx");
        map.put("xfbjbrList", "cXfczXfbjbr");
        map.put("xffywtList", "cXfczXffywt");
        map.put("xfblList", "cXfczXfbl");
        map.put("xfjbrList", "cXfczXfjbr");
        XFCZXX_TO_XFXX_MAP = Collections.unmodifiableMap(map);
    }
}

```

