<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>派驻——线索排查会详细设计 | VuePress</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="the new world">
    <link rel="preload" href="/assets/css/0.styles.93986fde.css" as="style"><link rel="preload" href="/assets/js/app.f21cdc56.js" as="script"><link rel="preload" href="/assets/js/2.9f03f641.js" as="script"><link rel="preload" href="/assets/js/7.2342caa0.js" as="script"><link rel="prefetch" href="/assets/js/10.c680aa57.js"><link rel="prefetch" href="/assets/js/11.0f25b5a9.js"><link rel="prefetch" href="/assets/js/12.e61c4ca7.js"><link rel="prefetch" href="/assets/js/3.afe6d1cb.js"><link rel="prefetch" href="/assets/js/4.c57904d7.js"><link rel="prefetch" href="/assets/js/5.c57eb98c.js"><link rel="prefetch" href="/assets/js/6.cf5042a3.js"><link rel="prefetch" href="/assets/js/8.90d61c22.js"><link rel="prefetch" href="/assets/js/9.27cb5384.js">
    <link rel="stylesheet" href="/assets/css/0.styles.93986fde.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">VuePress</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="派驻-线索排查会详细设计"><a href="#派驻-线索排查会详细设计" class="header-anchor">#</a> 派驻——线索排查会详细设计</h1> <p>author: 孙文浩</p> <p>date: 2019.11.14.</p> <hr> <h2 id="目录"><a href="#目录" class="header-anchor">#</a> 目录</h2> <ul><li><a href="#%E6%A6%82%E8%BF%B0">概述</a></li> <li><a href="#1%E6%8E%92%E6%9F%A5%E4%BC%9A%E9%A6%96%E9%A1%B5">1排查会首页</a> <ul><li><a href="#1.1%E5%8A%9F%E8%83%BD%E6%8F%8F%E8%BF%B0">1.1功能描述</a></li> <li><a href="#1.2%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1">1.2数据库设计</a></li> <li><a href="#1.3%E8%AF%A6%E6%83%85">1.3详情</a></li></ul></li> <li><a href="#2%E4%BC%9A%E8%AE%AE%E5%8A%9E%E7%90%86%E9%A1%B5%E9%9D%A2">2会议办理页面</a> <ul><li><a href="#2.1%E5%8A%9F%E8%83%BD%E6%8F%8F%E8%BF%B0">2.1功能描述</a></li> <li><a href="#2.2%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1">2.2数据库设计</a></li> <li><a href="#2.3%E8%AF%A6%E6%83%85">2.3详情</a></li></ul></li> <li><a href="#3%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E5%9C%BA%E6%99%AF%E6%8E%A7%E5%88%B6">3业务流程场景控制</a></li> <li><a href="#4%E5%BC%80%E5%8F%91%E8%AE%A1%E5%88%92">4开发计划</a></li></ul> <hr> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>V0.2版本针对V0.1版本流程简化</p> <ol><li>原三次提交（审批）操作，简化为一次，省去上会线索提交操作，处置建议、会后材料提价操作合并</li> <li>页面从原来的六个页面简化为2个，首页列表页面、办理页面</li> <li>会议流程简化，原来多个会议状态简化为2个，进行中、已结束</li></ol> <hr> <h2 id="_1排查会首页"><a href="#_1排查会首页" class="header-anchor">#</a> 1排查会首页</h2> <h3 id="_1-1功能描述"><a href="#_1-1功能描述" class="header-anchor">#</a> 1.1功能描述</h3> <ol><li>添加会议</li> <li>进行中会议、已结束会议的列表展示，页面提供添加排查会入口。</li> <li>进行中，提供线索登记、变更会议、删除会议很审批详情操作入口。</li> <li>已结束，提供会议详情和审批详情入口。</li></ol> <h3 id="_1-2数据库设计"><a href="#_1-2数据库设计" class="header-anchor">#</a> 1.2数据库设计</h3> <ul><li><p>t_xspch</p> <table><thead><tr><th>字段名</th> <th>字段含义</th> <th>字段类型</th> <th>字段长度</th></tr></thead> <tbody><tr><td>c_bh</td> <td>排查会编号</td> <td>VC</td> <td>32</td></tr> <tr><td>c_hymc</td> <td>会议名称</td> <td>VC</td> <td>300</td></tr> <tr><td>c_hydd</td> <td>会议地点</td> <td>VC</td> <td>300</td></tr> <tr><td>d_hysj</td> <td>会议时间</td> <td>TIMESTAMP</td> <td>300</td></tr> <tr><td>c_bz</td> <td>备注</td> <td>VC</td> <td>300</td></tr> <tr><td>c_chry</td> <td>参会人员</td> <td>VC</td> <td>300</td></tr> <tr><td>c_hyzt</td> <td>会议状态</td> <td>VC</td> <td>300</td></tr> <tr><td>c_cbr</td> <td>承办人(经办人)</td> <td>VC</td> <td>300</td></tr> <tr><td>c_cbbm</td> <td>承办部门</td> <td>VC</td> <td>300</td></tr> <tr><td>c_cbdw</td> <td>承办单位</td> <td>VC</td> <td>300</td></tr> <tr><td>c_czr</td> <td>操作人</td> <td>VC</td> <td>300</td></tr> <tr><td>dt_cjsj</td> <td>创建时间</td> <td>TIMESTAMP</td> <td>300</td></tr> <tr><td>dt_zhgxsj</td> <td>最后更新时间</td> <td>TIMESTAMP</td> <td>300</td></tr> <tr><td>c_bgyy</td> <td>变更原因</td> <td>VC</td> <td>300</td></tr> <tr><td>c_bglx</td> <td>变更类型</td> <td>VC</td> <td>300</td></tr></tbody></table></li> <li><p>t_pch_shxs</p> <table><thead><tr><th>字段名</th> <th>字段含义</th> <th>字段类型</th> <th>字段长度</th></tr></thead> <tbody><tr><td>c_bh</td> <td>上会线索编号</td> <td>VC</td> <td>32</td></tr> <tr><td>c_wtxs_bh</td> <td>zjjd推送线索的编号</td> <td>VC</td> <td>32</td></tr> <tr><td>c_xspch_bh</td> <td>排查会编号</td> <td>VC</td> <td>32</td></tr> <tr><td>c_cbbm</td> <td>承办部门</td> <td>VC</td> <td>32</td></tr></tbody></table></li></ul> <h3 id="_1-3详情"><a href="#_1-3详情" class="header-anchor">#</a> 1.3详情</h3> <ul><li><p>列表查询：</p> <ol><li><p>根据会议时间降序、按会议状态分组</p> <div class="language- extra-class"><pre><code> 问题线索数统计维度：推送至pch库中的线索数
</code></pre></div></li> <li><p>页面操作根据会议状态展示区分：</p> <table><thead><tr><th>会议状态</th> <th style="text-align:center;">状态值</th> <th style="text-align:center;">所在页签</th> <th>展示的操作入口</th></tr></thead> <tbody><tr><td>进行中（未提审批）</td> <td style="text-align:center;">hyzt=3</td> <td style="text-align:center;">进行中</td> <td>线索登记、变更会议、删除会议</td></tr> <tr><td>审批中</td> <td style="text-align:center;">hyzt=3,dqzt=0</td> <td style="text-align:center;">进行中</td> <td>审批详情</td></tr> <tr><td>审批通过</td> <td style="text-align:center;">hyzt=3,dqzt=1</td> <td style="text-align:center;">进行中</td> <td>线索登记、审批详情</td></tr> <tr><td>审批退回</td> <td style="text-align:center;">hyzt=3,dqzt=2</td> <td style="text-align:center;">进行中</td> <td>线索登记、审批详情</td></tr> <tr><td>已结束</td> <td style="text-align:center;">hyzt=6</td> <td style="text-align:center;">已结束</td> <td>会议详情、审批详情</td></tr></tbody></table></li></ol></li></ul> <blockquote><p>审批提交后，需要对c_hyzt字段进行更新，更新动作在zjjdApi中完成</p></blockquote> <blockquote><p>会议状态：进行中3、审批中（dqzt=1）、审批通过（dqzt=2）、审批退回（dqzt=3）、已结束6（审批通过）</p></blockquote> <blockquote><p>0：未读，1：审批中，2：审批结束，3：退回，4：撤回，5：退回后重新发起又撤回</p></blockquote> <ul><li><p>发起、变更会议弹框</p> <p>通过同一个模态框实现，复用pchsy.html的模态框，模态框控件控制，根据页面操作入口传参控制</p></li> <li><p>页面详情入口</p> <p>对接详情服务</p> <ol><li>会议详情</li> <li>审批详情</li></ol></li></ul> <hr> <h2 id="_2会议办理页面"><a href="#_2会议办理页面" class="header-anchor">#</a> 2会议办理页面</h2> <h3 id="_2-1功能描述"><a href="#_2-1功能描述" class="header-anchor">#</a> 2.1功能描述</h3> <ol><li>添加上会线索</li> <li>录入处置建议</li> <li>删除添加的上会线索</li> <li>详情查看</li> <li>导出处置建议分类表</li> <li>附件上传、预览、下载、删除</li> <li>文书生成、编辑、删除</li> <li>审批（涵盖审批开关）</li></ol> <h3 id="_2-2数据库设计"><a href="#_2-2数据库设计" class="header-anchor">#</a> 2.2数据库设计</h3> <h3 id="_2-3详情"><a href="#_2-3详情" class="header-anchor">#</a> 2.3详情</h3> <blockquote><p>接口相关内容，处置相关需求开发后调整</p></blockquote> <ul><li>待添加上会线索查询：</li></ul> <ol><li>可复用原页面模块，去除是否上会的条件过滤。</li> <li>查数接口数据查询范围：未上会线索、待处置中重新开始的暂存待查线索
<ul><li><p>从执纪监督查询待上会线索给pch：</p> <p>GET:   http://ip:port/api/getPchDshxs</p> <p>请求体：</p> <p>响应体：</p></li> <li><p>标记执纪监督的线索被添加pch：</p> <p>PATCH:  http://ip:port/api/tagOnShxs</p> <p>请求体：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token string">&quot;407e183450264f40bbbf6500a1cff942&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;54523b60cf8c4d8499d415438e2dbd30&quot;</span>
<span class="token punctuation">]</span>

</code></pre></div><p>响应体：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;success&quot;</span><span class="token operator">:</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span><span class="token string">&quot;ok&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ol> <ul><li><p>批量添加上会线索（兼容单个添加）：</p> <ul><li><p>推送已添加上会的线索至排查会接口：</p> <p>POST:   http://ip:port/api/addPchShxs{pchbh}</p> <p>请求体：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;cBh&quot;</span><span class="token operator">:</span><span class="token string">&quot;2cebf390a0ec4fa1be84def2a5d3e559&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span> 
</code></pre></div><p>响应体：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;success&quot;</span><span class="token operator">:</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span><span class="token string">&quot;ok&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p>删除已添加的上会线索</p> <div class="language- extra-class"><pre><code>  DELETE:http://ip:port/api/delShxs/{wtxsbh}
</code></pre></div><table><thead><tr><th>请求参数</th> <th>参数含义</th></tr></thead> <tbody><tr><td>wtxsbh</td> <td>问题线索编号</td></tr></tbody></table></li> <li><p>线索变更会议接口</p> <div class="language- extra-class"><pre><code>  PATCH:http://ip:port/api/changeShxsToNewPch/{pchbh}
</code></pre></div><table><thead><tr><th>请求参数</th> <th>参数含义</th></tr></thead> <tbody><tr><td>pchbh</td> <td>排查会编号</td></tr></tbody></table></li> <li><p>录入处置意见</p> <ol><li>继续办理线索在具体办理阶段中选择上会，不开放录入处置意见操作入口，根据t_pch_shxs.c_sfsh字段控制。</li> <li>录入处置意见模态框，页面控制，js以及后台功能方法逻辑可复用或优化</li></ol> <ul><li><p>承办人、审理人下拉列表获取人员调用的接口（agxtApi接口需要调整）：</p> <p>GET:    http://ip:port/api/v1/nbfz/{type}/{userId/ssbm}</p> <p>type=1，传userid，获取部门下所有人员</p> <div class="language-json extra-class"><pre class="language-json"><code>
<span class="token punctuation">{</span>
        <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true/false&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ok/missing type&quot;</span>
        <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;689754742&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽省案件监督承办人01&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;689764073&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽省案件监督承办人02&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;689770012&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽省案件监督承办人03&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;1119307109&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽案管室主任&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;1205183595&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽案管线索管理员1&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;1205197887&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽案管线索管理员2&quot;</span>
                <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>type=2，传ssbm，获取所有内部分组信息</p> <div class="language-json extra-class"><pre class="language-json"><code>
<span class="token punctuation">{</span>
        <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true/false&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ok/missing type&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;内部分组编号&quot;</span><span class="token operator">:</span><span class="token string">&quot;内部分组名称&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;273db09a1f8aeb358cb905f15152e2cb&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bvadf&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;0b496cd7d9a5cccc66368a2ef80e1542&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gfea&quot;</span>
                <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>type=3，传userid，获取人员所在分组的所有成员</p> <div class="language-json extra-class"><pre class="language-json"><code>
<span class="token punctuation">{</span>
        <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true/false&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ok/missing type&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;34000009002&quot;</span><span class="token operator">:</span> <span class="token string">&quot;王在胜&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;34000009001&quot;</span><span class="token operator">:</span> <span class="token string">&quot;郝家福&quot;</span>
                <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>type=4，传随机数，传所有内部分组组长</p> <div class="language-json extra-class"><pre class="language-json"><code>
<span class="token punctuation">{</span>
        <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true/false&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ok/missing type&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;529a1fea9f3f4881acd8b97e25f3c3b9&quot;</span><span class="token operator">:</span> <span class="token string">&quot;34000009002&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;内部分组编号&quot;</span><span class="token operator">:</span><span class="token string">&quot;组长id&quot;</span>
                <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>代码实现：</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;{type}/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">JSONObject</span> <span class="token function">getNbfzxx</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> type<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> ALL_USER<span class="token operator">:</span>
                    <span class="token class-name">String</span> deptId <span class="token operator">=</span> <span class="token class-name">OrganUtil</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeptId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">ConfigUtil</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;taap.base.uimApi.url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;/api/depts/&quot;</span> <span class="token operator">+</span> deptId <span class="token operator">+</span> <span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JSONObject</span><span class="token punctuation">&gt;</span></span> responseEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span>stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">JSONObject</span> userJsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">JSONArray</span> jsonArray <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJSONArray</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> jsonArray<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        userJsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>jsonArray<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> jsonArray<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;showName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> userJsonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> jsonObject<span class="token punctuation">;</span>
                <span class="token keyword">case</span> ALL_NBFZ<span class="token operator">:</span>
                    jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> nbfzService<span class="token punctuation">.</span><span class="token function">queryAllNbfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> jsonObject<span class="token punctuation">;</span>
                <span class="token keyword">case</span> ALL_NBFZRY<span class="token operator">:</span>
                    jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> nbfzService<span class="token punctuation">.</span><span class="token function">queryAllUserInNbfz</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> jsonObject<span class="token punctuation">;</span>
                <span class="token keyword">case</span> ALL_NBFZXX<span class="token operator">:</span>
                    jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> nbfzService<span class="token punctuation">.</span><span class="token function">queryNbfzxx</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> jsonObject<span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;missing type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;传参有误：missing type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;missing type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;获取内部分组相关信息出错&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> jsonObject<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> jsonObject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>承办人、审理人下拉类别获取人员在办案件数的接口 ：</p> <p>POST http://ip:port/api/cbr/countzbjs</p> <p>请求体：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
                <span class="token property">&quot;689754742&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽省案件监督承办人01&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;689764073&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽省案件监督承办人02&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;689770012&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽省案件监督承办人03&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;1119307109&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽案管室主任&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;1205183595&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽案管线索管理员1&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;1205197887&quot;</span><span class="token operator">:</span> <span class="token string">&quot;安徽案管线索管理员2&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;34000009004&quot;</span><span class="token operator">:</span> <span class="token string">&quot;夏延生&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;34000009005&quot;</span><span class="token operator">:</span> <span class="token string">&quot;杜忠法&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;34000009002&quot;</span><span class="token operator">:</span> <span class="token string">&quot;王在胜&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;34000009003&quot;</span><span class="token operator">:</span> <span class="token string">&quot;楼伟成&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>响应体：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;1223234234&quot;</span><span class="token operator">:</span><span class="token string">&quot;120&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;1257676766&quot;</span><span class="token operator">:</span><span class="token string">&quot;100&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码实现</p> <div class="language-java extra-class"><pre class="language-java"><code>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/countzbjs&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">JSONObject</span> <span class="token function">getZbsl</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">JSONObject</span> jsonObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JSONObject</span> jb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ryidList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jsonObject<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> ryidList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jb<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jb<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jb<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> cbrzbService<span class="token punctuation">.</span><span class="token function">getZbsl</span><span class="token punctuation">(</span>ryidList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jb<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jb<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;missing type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;获取承办人相关信息出错&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> jb<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> jb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">JSONObject</span> <span class="token function">getZbsl</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ryidList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> listMap <span class="token operator">=</span> tZhbaWtxsMapper<span class="token punctuation">.</span><span class="token function">selectZbsl</span><span class="token punctuation">(</span>ryidList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listMap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;c_cbr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;c_ajs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jsonObject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
        



</code></pre></div></li></ul></li> <li><p>生成处置建议分类表</p> <p>保存时hyjd存0，通过hyjd=0排序，将处置建议分类表排在页面列表第一位</p></li> <li><p>文书、审批相关</p> <ol><li>文书模板增加提交审批入口</li> <li>文书模板增加提交审批按钮</li> <li>文书模板增加需要审批状态字段</li></ol> <ul><li><p>调用审批页面</p> <div class="language- extra-class"><pre><code>  url:http://ip:port/spfw/spgzqsq.html/?businessKey=&amp;dataId=&amp;spType=&amp;attachmentUrl=&amp;detailUrl=&amp;sysId=
</code></pre></div></li> <li><p>开放文书附件查询接口给审批调用</p> <div class="language- extra-class"><pre><code>  GET:http://ip:port/pz-xspch/queryWsYFj/{ywbh}/{cbr}
</code></pre></div></li></ul></li> <li><p>附件上传</p> <ul><li><p>复用文件上传模块，保存逻辑调整</p> <p>保存时绑定附件到人和内部分组</p></li> <li><p>附件的数据查询</p></li></ul> <ol><li>有数据权限，根据数据权限查</li> <li>没有数据权限根据人查，根据数据库字段c_czr过滤</li> <li>如果是组长再根据内部分组编号查询</li></ol> <ul><li>对于列表排序问题</li></ul> <ol><li>生成处置建议分类表，每次生成hyjd=0</li> <li>上传的附件，hyjd=1</li></ol></li> <li><p>审批通过后操作（zjjdApi操作）</p> <ol><li><p>流程操作</p> <p>对应zjjdApi中代码片段（JsspCallBack.java）：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">case</span> PCHHYJY<span class="token operator">:</span>
    restTemplate<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span>systemConfig<span class="token punctuation">.</span><span class="token function">getXspch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/api/xspch/wtxsczfs/&quot;</span> <span class="token operator">+</span> dataId<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> PCHHCZYJFLB<span class="token operator">:</span>
    <span class="token comment">//排查会后处置意见变更</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> dataId<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> pchId <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> cbbm <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    xspchService<span class="token punctuation">.</span><span class="token function">sendPchData</span><span class="token punctuation">(</span>pchId<span class="token punctuation">,</span> cbbm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>推送zjjd字段：</p> <table><thead><tr><th>字段名</th> <th>字段含义</th></tr></thead> <tbody><tr><td>t_zhba_wtxs.c_sfsh</td> <td>是否上会（置为2）</td></tr> <tr><td>t_zhba_wtxs.c_pchhczfs</td> <td>排查会处置方式</td></tr> <tr><td>t_zhba_wtxs.c_pchzt</td> <td>排查会状态（置为3）</td></tr> <tr><td>t_zhba_xsfl.c_xsflczfs</td> <td>线索分流处置方式</td></tr> <tr><td>t_zhba_xsfl.c_czjy</td> <td>处置建议</td></tr> <tr><td>t_zhba_xsfl.c_xsfljsbm</td> <td>线索分流接收部门</td></tr></tbody></table></li> <li><p>pch内部更新字段：</p> <table><thead><tr><th>字段名</th> <th>字段含义</th></tr></thead> <tbody><tr><td>t_pch_shxs.c_spzt</td> <td>审批状态</td></tr></tbody></table></li></ul></li> <li><p>排查会内部状态控制</p> <div class="language- extra-class"><pre><code> t_spgl.c_dqzt=0：审批中
 页面控制变量校验库中该字段，禁止页面操作

 t_spgl.c_dqzt=1：审批通过
 页面控制变量校验库中该字段，禁止页面操作

 t_spgl.c_dqzt=2：审批退回
 页面控制变量校验库中该字段，开放页面操作
</code></pre></div><p>页面通过sftjsp参数控制</p> <div class="language- extra-class"><pre><code> hyzt=3,dqzt=0 or dqzt=2时：sftjsp=false
 其他情况：sftjsp=false
</code></pre></div></li></ol></li></ul> <hr> <h2 id="_3业务流程场景控制"><a href="#_3业务流程场景控制" class="header-anchor">#</a> 3业务流程场景控制</h2> <ul><li><p>已上会线索不存在再次上会</p></li> <li><p>添加排查会接口查询数据范围</p> <ol><li>未上会线索</li> <li>处置建议阶段暂存待查数据</li></ol></li> <li><p>页面操作功能权限
1.细化权限点（待梳理），根据权限点控制相关功能模块</p></li></ul> <hr> <h2 id="_4开发计划"><a href="#_4开发计划" class="header-anchor">#</a> 4开发计划</h2> <table><thead><tr><th>模块</th> <th>功能点</th> <th style="text-align:center;">工作量（单位：人/天）</th></tr></thead> <tbody><tr><td>排查会首页</td> <td>首页列表修改，查询+操作控制</td> <td style="text-align:center;">1</td></tr> <tr><td>排查会首页</td> <td>首页添加、变更会议+部分样式</td> <td style="text-align:center;">1</td></tr> <tr><td>办理页面</td> <td>添加上会线索，查询接口+推数接口+保存+添加列表页面</td> <td style="text-align:center;">2</td></tr> <tr><td>办理页面</td> <td>已添加上会线索列表查询+录入处置建议+删除接口</td> <td style="text-align:center;">2</td></tr> <tr><td>办理页面</td> <td>生成处置建议分类表+附件上传+附件列表数据权限</td> <td style="text-align:center;">2</td></tr> <tr><td>办理页面</td> <td>文书模板修改+文书对接+审批对接</td> <td style="text-align:center;">3.5</td></tr> <tr><td>流程相关</td> <td>处置建议提交+会后材料提交接口整合</td> <td style="text-align:center;">1.5</td></tr> <tr><td>权限</td> <td>数据权限+功能权限</td> <td style="text-align:center;">2</td></tr></tbody></table></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f21cdc56.js" defer></script><script src="/assets/js/2.9f03f641.js" defer></script><script src="/assets/js/7.2342caa0.js" defer></script>
  </body>
</html>
