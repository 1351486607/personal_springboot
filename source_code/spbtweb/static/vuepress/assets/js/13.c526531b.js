(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{352:function(s,a,t){"use strict";t.r(a);var e=t(40),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"sybase命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sybase命令"}},[s._v("#")]),s._v(" Sybase命令")]),s._v(" "),t("p",[s._v("@[toc]")]),s._v(" "),t("h2",{attrs:{id:"数据库配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库配置"}},[s._v("#")]),s._v(" 数据库配置")]),s._v(" "),t("h3",{attrs:{id:"修改最大连接数为500"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改最大连接数为500"}},[s._v("#")]),s._v(" 修改最大连接数为500")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'number of user connections',500\ngo\n")])])]),t("h3",{attrs:{id:"查询设备数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询设备数"}},[s._v("#")]),s._v(" 查询设备数")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'number of devices'\ngo\n")])])]),t("h3",{attrs:{id:"修改设备数为100"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改设备数为100"}},[s._v("#")]),s._v(" 修改设备数为100")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'number of devices'，100\ngo\n")])])]),t("h3",{attrs:{id:"缺省缓存分配页大小"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缺省缓存分配页大小"}},[s._v("#")]),s._v(" 缺省缓存分配页大小")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_poolconfig 'default data cache','200M','16K'\ngo\n")])])]),t("h3",{attrs:{id:"最大锁数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最大锁数"}},[s._v("#")]),s._v(" 最大锁数")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'number of locks',100000\ngo\n")])])]),t("h3",{attrs:{id:"配置最大内存数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置最大内存数"}},[s._v("#")]),s._v(" 配置最大内存数")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'max memory' ,2097151\ngo\n")])])]),t("h3",{attrs:{id:"配置最大在线cpu"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置最大在线cpu"}},[s._v("#")]),s._v(" 配置最大在线CPU")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'max online engines',4\ngo\nalter thread pool syb_default_pool with thread count = 4\ngo\n")])])]),t("h3",{attrs:{id:"配置启动cpu个数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置启动cpu个数"}},[s._v("#")]),s._v(" 配置启动cpu个数")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'number of engines at startup',4 \ngo\n")])])]),t("h3",{attrs:{id:"配置最大内存数-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置最大内存数-2"}},[s._v("#")]),s._v(" 配置最大内存数")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("sp_configure "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'max memory'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2097151")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--单位2k")]),s._v("\ngo\n")])])]),t("h3",{attrs:{id:"分配最大存储过程缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分配最大存储过程缓存"}},[s._v("#")]),s._v(" 分配最大存储过程缓存")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("sp_configure "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'procedure cache size'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--单位2k")]),s._v("\ngo\n")])])]),t("h3",{attrs:{id:"配置高速缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置高速缓存"}},[s._v("#")]),s._v(" 配置高速缓存")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_cacheconfig 'default data cache' , '700M'\ngo\n")])])]),t("h3",{attrs:{id:"网络包大小"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#网络包大小"}},[s._v("#")]),s._v(" 网络包大小")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'max network packet size',1024\ngo\n")])])]),t("h3",{attrs:{id:"最大打开对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最大打开对象"}},[s._v("#")]),s._v(" 最大打开对象")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'number of open object',9000\ngo\n")])])]),t("h3",{attrs:{id:"最大索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最大索引"}},[s._v("#")]),s._v(" 最大索引")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'number of open indexes',10000\ngo\n")])])]),t("h3",{attrs:{id:"最大锁数-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最大锁数-2"}},[s._v("#")]),s._v(" 最大锁数")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'number of locks',100000\ngo\n")])])]),t("h3",{attrs:{id:"增加网络内存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加网络内存"}},[s._v("#")]),s._v(" 增加网络内存")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'additional network memory',1024\ngo\n")])])]),t("h3",{attrs:{id:"锁内存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#锁内存"}},[s._v("#")]),s._v(" 锁内存")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'lock shared memory',512\ngo\n")])])]),t("h3",{attrs:{id:"优化tempdb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化tempdb"}},[s._v("#")]),s._v(" 优化tempdb")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("select dbid, name,segmap\nfrom sysusages, sysdevices\nwhere sysdevices.low <= sysusages.size +vstart\nand sysdevices.high >=sysusages.size+vstart -1\nand dbid =2\nand (status=2 or status=3) \ngo\nuse tempdb\ngo\nsp_dropsegment 'logsegment', 'tempdb', 'master' \ngo\nsp_dropsegment 'system', 'tempdb', 'master' \ngo\nsp_dropsegment 'default', 'tempdb', 'master' \nGo\n\nselect dbid, name,segmap\nfrom sysusages, sysdevices\nwhere sysdevices.low <= sysusages.size +vstart\nand sysdevices.high >=sysusages.size+vstart -1\nand dbid =2\nand (status=2 or status=3) \ngo\nsp_cacheconfig tempdb_cache, '100M'\ngo\nsp_poolconfig tempdb_cache,'50M','16K'\ngo\nsp_bindcache 'tempdb_cache',tempdb\ngo\nsp_helpcache tempdb_cache\nselect name,id from syscharsets\ndbcc traceon(3604)\ndbcc memusage\n")])])]),t("h2",{attrs:{id:"数据库安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库安装"}},[s._v("#")]),s._v(" 数据库安装")]),s._v(" "),t("h3",{attrs:{id:"数据库安装的优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库安装的优化"}},[s._v("#")]),s._v(" 数据库安装的优化")]),s._v(" "),t("h4",{attrs:{id:"应用数据库使用裸设备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用数据库使用裸设备"}},[s._v("#")]),s._v(" 应用数据库使用裸设备")]),s._v(" "),t("p",[s._v("若在UNIX（UNIXWARE）操 作系统下安装数据库服务器，请将SYBASE应用数据库的设备(device)安装成裸设备。即在创建应用数据库设备 （如：IVSP，DB160，NAP2000等）时用裸设备，把文件名指向 /dev/dsk/ 子目录下的相应文件。系统数据库设备（如:master等）仍然指向文件系统。")]),s._v(" "),t("h4",{attrs:{id:"补丁程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#补丁程序"}},[s._v("#")]),s._v(" 补丁程序")]),s._v(" "),t("p",[s._v("完成SYBASE数据库的安装，请注意原版的SYBASE软件都会带有最新的补丁，一定要把补丁打上，否则会出现一些莫名其妙的问题。FOR NT 版的补丁是一个ZIP文件，解压至C:/SYBASE子目录即可。")]),s._v(" "),t("h4",{attrs:{id:"安装-sybase-在线帮助"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-sybase-在线帮助"}},[s._v("#")]),s._v(" 安装 SYBASE 在线帮助")]),s._v(" "),t("p",[s._v("在安装好 SYBASE 后，在安装目录下有一文件：../scripts/ins_syn_sql，在服务器上执行该脚本：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Sybase for Unix版：./isql -Usa -P -i../scripts/ins_syn_sql\nSybase for Winnt版：isql -Usa -P -i/sybase/scripts/ins_syn_sql\n")])])]),t("p",[s._v("执行完毕后，即可在任意的 SYBASE 客户端上连接上 SQL SERVER ，在线取得任意命令的帮助：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('sp_syntax "关键字"\n如：sp_syntax "alter" 即可列出所有包含"alter"字符的命令\n')])])]),t("h3",{attrs:{id:"数据库配置的优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库配置的优化"}},[s._v("#")]),s._v(" 数据库配置的优化")]),s._v(" "),t("h4",{attrs:{id:"优化master数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化master数据库"}},[s._v("#")]),s._v(" 优化master数据库")]),s._v(" "),t("p",[s._v("首先加大master设备空间，初始默认为30M，加大为150M。然后加大master数据库空间，默认数据段和日志段各为5M大小，建议改为数据段100M，日志段50M：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("alter database master on master=95\n")])])]),t("h4",{attrs:{id:"优化tempdb数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化tempdb数据库"}},[s._v("#")]),s._v(" 优化tempdb数据库")]),s._v(" "),t("p",[s._v("首先创建tempdb设备，分配给tempdb数据库，默认tempdb数据库数据段和日志段各为2M大小，并创建在master设备上，建议改为数据段200M，日志段50M，创建在tempdb设备上：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("alter database tempdb on tempdb=200\n")])])]),t("p",[s._v("SQL SEVRER所有用户都共享工作表和临时表的tempdb数据库，tempdb主要瓶颈是磁盘I/0。解决办法是把tempdb放在更快的设备上。在 UNIX环境中，把tempdb放在文件系统中而不用原始的设备。由于tempdb在创建数据时，自动在master设备上创建为2M的数据库，为了减少 冲突，最好的办法是把tempdb从master设备中移走。为了达到上述目的，可采用如下办法实现：")]),s._v(" "),t("ul",[t("li",[s._v("在单用户状态下启动SQL SERVER，启动单用户方法：")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("dataserver -dmaster.dat -m\n")])])]),t("ul",[t("li",[s._v("以sa登录")]),s._v(" "),t("li",[s._v("在文件系统中创建一个哑数据库")]),s._v(" "),t("li",[s._v("删除sysusages和 sysdatabase表中对现有tempdb数据库的引用")]),s._v(" "),t("li",[s._v("获取哑数据库的数据库ID，相应修改sysusages和 ysdatabase表对tempdb的引用")]),s._v(" "),t("li",[s._v("重新启动数据库")])]),s._v(" "),t("p",[s._v("以在newdevice中创建200M的tempdb数据库为例，执行过程如下：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("create database newtemp on newdevice=200\ngo /* 创建新的数据库 */\nbegin tran\ngo /* 开始事务，防止操作错误时破坏整个SQL SERVER的运行*/\ndelete sysusages where dbid = 2\ndelete sysdatabases where dbid = 2\ngo /*删除系统表对tempdb的引用，只能在单用户状态下执行*/\nselect dbid from sysdatabases where name = ‘newtemp’\ngo /*获取newtemp数据库ID，假定为10*/\nupdate sysusages set dbid = 2 where dbid=10\nupdate sysdatabases set name=’tempdb’,dbid=2 where name=’newtemp’\ngo /*修改数据库的引用，对newtemp的引用改为对tempdb的引用*/\nselect name,dbid, from sysdatabases where name = ‘tempdb’\nselect * from sysusages where dbid = 2\ngo /*测试修改是否正确，正确则提交，否则可用rollback回退*/\ncommit tran\ngo /*修改成功，重新启动系统*/\n")])])]),t("p",[t("strong",[s._v("注意：这种方法只对tempdb有效，其他数据库不能采用这种方法。因为在SQL SERVER启动时，tempdb每次都重新初始化。")])]),s._v(" "),t("h4",{attrs:{id:"优化系统参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化系统参数"}},[s._v("#")]),s._v(" 优化系统参数")]),s._v(" "),t("p",[s._v("以下参数为标准建议值，可根据实际情况修改。\n优化系统参数的SQL脚本注释")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'total memory', 100000\n")])])]),t("p",[s._v("优化数据库的内存，应根据不同机器配置设置, 建议为一半的物理内存大小。以db_block为单位，即每个单位为2k，上例为200M，默认为24M：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('sp_configure "lock scheme" , 1,"datarows" // 系统默认为表级锁，优化为行锁\nsp_configure "number of locks" , 10000 // 加大最大锁进程数, 默认为5000。\nalter table table_name lock datarows // 如果设置一个已经存在的表(tabel)的锁方式为行锁\nsp_configure \'procedure cache percent\' ,30 // 缺省值：20 建议值：procedure使用频率高时采用较大的值，不超过30\nsp_configure "number of user connections",100 // 最大用户连接数，默认为25，每个连接要占70k内存\nsp_configure \'number of devices\',20 // 将最大设备文件数据改为15个\nsp_configure ‘number of Open databases’,20 // 最大打开数据库个数，对于需在一台数据库服务上打个多个数据库则需加大此参数，默认为15\nSp_configure ‘max online engines CPU’,2 // 缺省值：1 建议值：采用实际机器的CPU个数\nSp_configure ‘total data cache size’,60000 // 缺省值：0 建议值：使用SQL SERVER内存的30%\n')])])]),t("p",[s._v("如果上述参数改动后SYBASE启动不正常，则可检查SYBASE的错误日志，把SYBASE.cfg中的相应选项修改为较小的值。\n附：SYBASE SQL SERVER 内存的分配")]),s._v(" "),t("ul",[t("li",[s._v("SQL SERVER 可执行代码        3-4M")]),s._v(" "),t("li",[s._v("SQL SERVER 使用的静态内存        2.2-3.25M")]),s._v(" "),t("li",[s._v("用户可配置的参数所占用内存，以下示例(11.9.2版)：")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("配置项")]),s._v(" "),t("th",[s._v("默认值")]),s._v(" "),t("th",[s._v("内存占用")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("用户连接数(user connections)")]),s._v(" "),t("td",[s._v("25")]),s._v(" "),t("td",[s._v("70k/个")])]),s._v(" "),t("tr",[t("td",[s._v("打开的数据库数(open database)")]),s._v(" "),t("td",[s._v("12")]),s._v(" "),t("td",[s._v("60k/个")])]),s._v(" "),t("tr",[t("td",[s._v("打开的对象数(open objects)")]),s._v(" "),t("td",[s._v("500")]),s._v(" "),t("td",[s._v("1k/个")])]),s._v(" "),t("tr",[t("td",[s._v("打开的索引数(open indexs)")]),s._v(" "),t("td",[s._v("500")]),s._v(" "),t("td",[s._v("1k/个")])]),s._v(" "),t("tr",[t("td",[s._v("锁数目(locks)")]),s._v(" "),t("td",[s._v("5000")]),s._v(" "),t("td",[s._v("0.1k/个")])]),s._v(" "),t("tr",[t("td",[s._v("数据库设备数(data device)")]),s._v(" "),t("td",[s._v("10")]),s._v(" "),t("td",[s._v("0.5k/个")])])])]),s._v(" "),t("ul",[t("li",[s._v("剩余部份分配\n过程缓存 ( 由 procedure cache percent 决定，默认值为 20% )\n数据缓存 ( 默认值为减去1、2、3项的 80% )")])]),s._v(" "),t("h4",{attrs:{id:"优化数据库系统属性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化数据库系统属性"}},[s._v("#")]),s._v(" 优化数据库系统属性")]),s._v(" "),t("p",[s._v("-方法一：在sybase center中选择数据库属性，将属性中options选项中的下列项目选中。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("allow select into/bulk copy\ntruncate log on checkpoint\ncheckpoint on recovery\nabort transction on full log\nfree space accounting\nallow nulls by default\nauto identity column in non-unquie index \n")])])]),t("ul",[t("li",[s._v("方法二：在SQLPLUS中执行下列SQL脚本，如：")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('sp_dboption mydb,"abort tran on log full",true（设定当数据库的日志空间满时，就终止该进程，使用 sa 用户）\n\nsp_dboption mydb," trunc log on chkpt ",true\nsp_dboption mydb," no chkpt on recovery",true\nsp_dboption mydb," no free space acctg ",true\nsp_dboption mydb,"allow nulls by default",true\nsp_dboption mydb," auto identity dbo use only ",true\n')])])]),t("h4",{attrs:{id:"创建阈值存储过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建阈值存储过程"}},[s._v("#")]),s._v(" 创建阈值存储过程")]),s._v(" "),t("p",[s._v("可根据不同的应用修改以下脚本或创建多个阈值存储过程，并在配置阈值时指定相应的存储过程：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("create procedure sp_thresholdaction \n@dbname varchar(30),\n@segmentname varchar(30),\n@free_space int,\n@status int as dump transaction @dbname with no_log \nprint \"LOG DUMP: '%1!' for '%2!' dumped\",@segmentname,@dbname\ngo\n")])])]),t("h4",{attrs:{id:"配置多个阈值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置多个阈值"}},[s._v("#")]),s._v(" 配置多个阈值")]),s._v(" "),t("ul",[t("li",[s._v("方法一：\n打开 Sybase Central，双击相应数据库(database)的段 Segments ->; logsegment，在Thresholds 页面中可设置自动清除日志的阀值。其中有 Last Chance 的一行是系统默认的最后机会阀值，即系统日志空闲空间小于该值时为最后一次自动清除日志的机会。设置时阀值的大小可设为日志总空间大小的20%左右。\n另外再增加多个阈值。")]),s._v(" "),t("li",[s._v("方法二：\n"),t("ul",[t("li",[s._v("使用如下指令查出数据库中日志的容量（用页表示）")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('select sum(size) from master..sysusages where dbid=db_id("database_name" and (segmap&4)=4\n')])])]),t("ul",[t("li",[s._v("使用sp_addthreshold增加新的阈值，大小为日志容量的50%,如上面语句显示值为2048")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_addthreshold database_name,logsegment,1024，proc_dump_display\n")])])])])]),s._v(" "),t("p",[t("strong",[s._v('注意：因一个大事务时可能会越过当前的threshold，所以必须加多个threshold，\n使用命令select @@thresh_hysteresis查看数据库的滞后值，如结果为64页，则下一个阈值设为"最近的阈值-（2*64）"，请在所设阈值再按这种原则各增加两个更小的阈值。')])]),s._v(" "),t("h3",{attrs:{id:"索引的优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引的优化"}},[s._v("#")]),s._v(" 索引的优化")]),s._v(" "),t("p",[s._v("在良好的数据库设计基础上，需高效地使用索引，并经常的维护索引，下文介绍关于索引的相关内容。")]),s._v(" "),t("h4",{attrs:{id:"创建索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建索引"}},[s._v("#")]),s._v(" 创建索引")]),s._v(" "),t("p",[s._v("索引分为三类：聚簇索引(clustered indexes)、非聚簇索引(nonclustered indexes)、覆盖索引(covering indexes)\n鉴于索引加快了查询速度，但减慢了数据更新速度的特点。可通过在一个段上建表，而在另一个段上建其非聚簇索引，而这两段分别在单独的物理设备上来改善操作性能。\ncreate [unique][clustered|nonclustered] index index_name on table_name(column_name...)")]),s._v(" "),t("h4",{attrs:{id:"重建索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重建索引"}},[s._v("#")]),s._v(" 重建索引")]),s._v(" "),t("p",[s._v("随着数据行的插入、删除和数据页的分裂，有些索引页可能只包含几页数据，另外应用在执行大块I/O的时候，重建非聚簇索引可以降低分片，维护大块I/O的效率。重建索引实际上是重新组织B-树空间。在下面情况下需要重建索引：")]),s._v(" "),t("ul",[t("li",[s._v("数据和使用模式大幅度变化。")]),s._v(" "),t("li",[s._v("排序的顺序发生改变。")]),s._v(" "),t("li",[s._v("要进行大量插入操作或已经完成。")]),s._v(" "),t("li",[s._v("使用大块I/O的查询的磁盘读次数比预料的要多。")]),s._v(" "),t("li",[s._v("由于大量数据修改，使得数据页和索引页没有充分使用而导致空间的使用超出估算。")]),s._v(" "),t("li",[s._v("dbcc检查出索引有问题。")])]),s._v(" "),t("p",[s._v("当重建聚簇索引时,这张表的所有非聚簇索引将被重建.")]),s._v(" "),t("h4",{attrs:{id:"索引统计信息的更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引统计信息的更新"}},[s._v("#")]),s._v(" 索引统计信息的更新")]),s._v(" "),t("p",[s._v("当在一个包含数据的表上创建索引的时候，SQL Server会创建分布数据页来存放有关索引的两种统计信息：分布表和密度表。优化器利用这个页来判断该索引对某个特定查询是否有用。但这个统计信息并不 动态地重新计算。这意味着，当表的数据改变之后，统计信息有可能是过时的，从而影响优化器追求最有工作的目标。因此，在下面情况下应该运行update statistics命令：")]),s._v(" "),t("ul",[t("li",[s._v("数据行的插入和删除修改了数据的分布。")]),s._v(" "),t("li",[s._v("对用truncate table删除数据的表上增加数据行。")]),s._v(" "),t("li",[s._v("修改索引列的值。")])]),s._v(" "),t("h3",{attrs:{id:"查询优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询优化"}},[s._v("#")]),s._v(" 查询优化")]),s._v(" "),t("h4",{attrs:{id:"not-in子句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#not-in子句"}},[s._v("#")]),s._v(" NOT IN子句")]),s._v(" "),t("p",[s._v("不知大家是否喜欢使用‘NOT IN’这样的操作，如果是，那尽量使用(NOT) EXISTS 替代。\n例子：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("语句1\nSELECT dname, deptno FROM dept WHERE deptno NOT IN (SELECT deptno FROM emp);\n语句2\nSELECT dname, deptno FROM dept WHERE NOT EXISTS (SELECT deptno FROM emp WHERE dept.deptno = emp.deptno);\n")])])]),t("p",[s._v("明显的，2要比1的执行性能好很多，因为1中对emp进行了full table scan,这是很浪费时间的操作。而且1中没有用到emp的index，因为没有where子句。而2中的语句对emp进行的是range scan。")]),s._v(" "),t("h4",{attrs:{id:"海量查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#海量查询"}},[s._v("#")]),s._v(" 海量查询")]),s._v(" "),t("ul",[t("li",[s._v("在海量查询时尽量少用格式转换。")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("如用\nWHERE a.order_no = b.order_no\n而不用\nWHERE TO_NUMBER (substr(a.order_no, instr(b.order_no, '.') - 1)= TO_NUMBER (substr(a.order_no, instr(b.order_no, '.') - 1)\n")])])]),t("ul",[t("li",[s._v("查询海量数据是可以使用optimizer hints，例如/*+ORDERED */")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("如用\nSELECT /*+ FULL(EMP) */ E.ENAME FROM EMP E WHERE E.JOB = 'CLERK';\n而不用\nSELECT E.ENAME FROM EMP E WHERE E.JOB || '' = 'CLERK';\n")])])]),t("ul",[t("li",[t("p",[s._v("对于数据量较大和业务功能较复杂的系统，Sybase的默认参数根本无法满足需要，必须进行优化。系统数据库方面的优化从两方面进行，一个是调 整数据库系统的一些性能参数的值，另一个是应用程序的调优。应用程序的调优调整hsql和sql的写法，配合sql合理的建索引，这里主要对Sybase 系统一些基本的性能参数的调优进行一个小结：")]),s._v(" "),t("ul",[t("li",[s._v("内存\n内存是对性能影响最大，也是最需要也是最难调优的地方。内存调优一定要，常用的需要调整的参数有：")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'max memory',XXXXXXX (设置为服务器内存的75%,重启生效)\nsp_configure 'allocate max shared mem',1 (启动的时候自动分配max memory指定的最大内存)\nsp_cacheconfig 'default data cache','1300M'(设置数据缓存为max memory的一半)\nsp_cacheconfig 'default data cache','cache_partition=2'\nsp_configure 'procedure cache size',102400 (过程高速缓存,通常是max mem20%-30%,这里是200M,在大量的执行sql的时候这个参数一定要调大)\n")])])]),t("p",[s._v('实际中遇到一个很头痛的问题， 32位Windows版本的Sybase 最大内存只能到搞到3G左右，"default data cache"的值超过 1500M Sybase实例就起不来了，导致服务器的16G内存形同虚设，所以如果大家的项目和我这个类似，服务器和操作系统由客户提供，还换不了的，内存不妨要求 个4G就够了，多了也浪费。')]),s._v(" "),t("ul",[t("li",[s._v("CPU\n当服务器的CPU个数多于一个时，可以考虑多CPU。实际上对于OS会自动调度，设一下只不过是控制的更精确一点。实际需要根据CPU数来修改，若CPU=N，一般设置为N-1。设置这个参数，比如我的服务器8个CPU, 就像下面这样设置：")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure 'max online engines',7\nsp_configure 'number of engines at startup',7\nsp_configure 'max parallel degree',1 (并行的度，大于或等于1)\nsp_configure 'number of worker processes',7 (并行度＊并发连接数＊1.5倍)\n")])])]),t("ul",[t("li",[s._v("连接数(这个没什么说的，数量管够就可以，默认数为25，可根据应用需要来修改。)")])])])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("    sp_configure 'number of user connections',600\n    查询数据库死进程\n    select * from master..syslogshold\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("- 锁\n数据库的锁机制其实是一个比较复杂的话题，这里只能简单说一下。Sybase数据库系统两个级别的锁机制：所有页锁、数据页锁。所有页锁在当数据库加锁时，既锁数据页，也锁索引页；数据页锁当数据库加锁时，只锁数据页，不锁索引页。\nSybase支持三种类型的锁: 数据表锁、数据页锁、数据行锁。 一些常用的调优命令和策略如下:\n```\nsp_configure 'number of locks',50000 （设置锁的数量）\n```\n系统设置时要把锁的数量设大一点，简单说就是要管够；如果需要节省空间，减少维护量，使用所有页锁机制；而如果需要加快速度，空间足够，使用数据页锁机制。\n```\nsp_sysmon '00:10:00',locks （检测表的使用情况）\n```\n当通过监测发现锁竞争超过15%时，首先修改加锁最重的表的锁机制，然后再把数据页锁设置为数据行锁。如果发现螺旋锁多，则为该表建立单独的命名缓存并对命名缓存进行分区。\n\n- I/O\n")])])]),t("p",[s._v("数据库调优总的思路是尽量减少和分散物理I/O，尽量减少网络I/O。\n减少物理I/O的办法有： 在命名缓存中增加大块的I/O缓冲池，把数据分散到多个硬盘上,采用RAID技术,建立段，使一个表跨越多个硬盘等等，基本和其他的数据库软件调优一样。\n减少网络I/O的办法是采用大数据包。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v('```\nsp_configure "default network packet size",2048 设置网络传送包的大小(需要重启动)\nsp_configure "max network packet size",2048\n```\n')])])]),t("h2",{attrs:{id:"sybase使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sybase使用"}},[s._v("#")]),s._v(" Sybase使用")]),s._v(" "),t("h3",{attrs:{id:"sql-advantage使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql-advantage使用"}},[s._v("#")]),s._v(" SQL Advantage使用")]),s._v(" "),t("p",[s._v("先点击server，里面点击connect连接到sybase服务端，开一个新窗口，写一些sql执行即可（ctrl+e）")]),s._v(" "),t("h3",{attrs:{id:"启动和关闭数据库，查看表结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动和关闭数据库，查看表结构"}},[s._v("#")]),s._v(" 启动和关闭数据库，查看表结构")]),s._v(" "),t("ul",[t("li",[s._v("看所有的库")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_helpdb\n")])])]),t("ul",[t("li",[s._v("使用一个库")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("use 库名（注意大小写）\n")])])]),t("ul",[t("li",[s._v("查看用户下所有表名")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("select name from sysobjects where type='U'\n或\nsp_tables\n")])])]),t("ul",[t("li",[s._v("查看表结构")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_help 表名（注意大小写）\n")])])]),t("ul",[t("li",[s._v("显示结果只显示一行")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("set rowcount 1\ngo\n")])])]),t("ul",[t("li",[s._v("输入你想查询的sql语句，记得最后要")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("set rowcount 0\ngo\n")])])]),t("ul",[t("li",[s._v("启动数据库")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[sybase@rosan128main install]$ pwd\n/opt/sybase/ASE-12_5/install\n[sybase@rosan128main install]$ ./RUN_rosantech &\n")])])]),t("ul",[t("li",[s._v("关闭数据库")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("先要看启动了什么服务\n1> select srvname from sysservers\n2> go\n srvname                        \n ------------------------------ \n SYB_BACKUP                     \n loopback                       \n rosanljw_BS                    \n rosantech                      \n\n(4 rows affected)\n\n关闭备份服务\n1> shutdown SYB_BACKUP\n2> go\n\n关闭\n1> shutdown with nowait\n2> go\n")])])]),t("h3",{attrs:{id:"dml和ddl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dml和ddl"}},[s._v("#")]),s._v(" DML和DDL")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("--建表\nuse test\ngo\n\ncreate table table1\n(test varchar(10))\ngo\n\n--仿照table1建立table2\nselect * from table1 into table2\ngo\n--------------------------------------------------------------------------------------\n\n--如果不能仿照需要修改一些参数\nsp_helpdb db_name    --查看SELECT into选项是否开启，没开需要手动开启\ngo\n \nuse master\ngo\n\nsp_dboption test,'select into',true        --（test为db_name）\ngo\n\ncheckpoint\ngo\n\nuse test\ngo\n\nselect * from table1 into table2\ngo\n")])])]),t("h3",{attrs:{id:"用户管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户管理"}},[s._v("#")]),s._v(" 用户管理")]),s._v(" "),t("ul",[t("li",[s._v("创建登陆用户（login）")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_addlogin user,user_password    --依次为用户名，密码\ngo\n")])])]),t("ul",[t("li",[s._v("数据库添加用户")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("use YWST \nGO\nsp_adduser user\nGO\n")])])]),t("ul",[t("li",[s._v("删除用户")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_dropuser user\ngo\n")])])]),t("ul",[t("li",[s._v("删除登录用户")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_droplogin user\ngo\n")])])]),t("h3",{attrs:{id:"sybase-ase参数配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sybase-ase参数配置"}},[s._v("#")]),s._v(" Sybase ASE参数配置")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("服务器级配置\n使用存储过程sp_configure配置ASE (和oracle的show parameter很像)")]),s._v(" "),t("ul",[t("li",[s._v("语法")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_configure [configname[, configvalue] | group_name | non_unique_parameter_fragment]\n")])])]),t("ul",[t("li",[s._v('作用\n查询服务器运行的当前值，设置服务器运行参数\n用 "sp_configure mem" 可以查看带有mem关键字的参数的具体配置，然后用"sp_configure 参数, 值"来配置新')])])])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("例1. 配置内存\n1)数据库使用内存\n指定ASE拥有的总的共享内存大小\nsp_configure 'max memory',nnn(单位为2K）( HP平台推荐物理内存的75%，其他平台80%)\nsp_configure 'allocate max shared mem',1（数据库服务启动时就分配内存）(推荐为1)\n2)配置缺省数据缓存的大小和分区\nsp_cacheconfig 'default data cache','xxxM'\nsp_cacheconfig 'default data cache','cache_partition=n'\n(根据CPU个数以及内存大小确定，需为2的N次方)\n3)配置存储过程的缓存大小\nsp_configure 'procedure cache size',nnn(单位为2K)\n\n例2. 配置CPU\nsp_configure‘max online engines’,n(cpu个数> 2时推荐CPU数目减1)\nsp_configure‘number of engines at startup’,n\n3. 其他\n1). number of devices (用户自己确定)\n指定ASE的可创建和打开的数据库设备的最大号数\n2). number of locks (用户自己确定)\n指定ASE可同时打开的锁的最大数目\n3). number of open objects (推荐8000-20000)\nASE的对象描述的缓存数\n4)number of open indexes (推荐2000-5000)\nASE的索引描述的缓存数\n5) stack size (如果有超长SQL和多层嵌套，推荐*2)\n数据库堆栈的大小\n6). default character set id(推荐使用cp936 –id 171)\n数据库服务器使用的字符集\n7). allow updates to system tables\n指定系统管理员是否可以更改系统表中的数据\n8)row lock promotion HWM，row lock promotion LWM\n行锁升级为表锁的阀值\n9)page lock promotion HWM，page lock promotion LWM\n页锁升级为表锁的阀值\n10) lock scheme\n缺省的对表加的锁类型(缺省为页锁)\n")])])]),t("ul",[t("li",[t("p",[s._v("数据库级配置\n使用存储过程sp_dboption更改数据库的数据库选项")]),s._v(" "),t("ul",[t("li",[s._v("语法sp_dboption[dbname, optname, {true | false}]")]),s._v(" "),t("li",[s._v("作用\n罗列出所有的数据库选项\n更改某个数据库的数据库选项")]),s._v(" "),t("li",[s._v("常见的数据库选项")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("trunclog on chkpt自动清日志(不能再做增量备份)\nselect into/bulkcopy允许快速BCP,selectinto\nddlin tran允许事务中创建对象\n")])])])])]),s._v(" "),t("p",[s._v("修改完成以后可以通过sp_helpdb查看到")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("例子：\n1> use master\n2> go\n\n1> sp_dboptionuserdb, \"trunclog on chkpt\", true\n2> go\n数据库‘userdb'的数据库选项'trunclog on chkpt'被打开。\n在被改变数据库中运行CHECKPOINT命令。\n(return status = 0)\n\n1> use userdb\n2> go\n1> checkpoint\n2> go\n")])])]),t("ul",[t("li",[s._v("修改字符集为中文\n"),t("ul",[t("li",[s._v("先进入到中文字符集的目录，把中文加载一下")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[sybase@rosan128main cp936]$ pwd\n/opt/sybase/charsets/utf8\n\n[sybase@rosan128main cp936]$ charset -Usa -P123456 -SNP binary.srt utf8\nLoading file 'binary.srt'.\n\n")])])])])]),s._v(" "),t("p",[s._v("Found a [sortorder] section.")]),s._v(" "),t("p",[s._v("This is Class-1 sort order.")]),s._v(" "),t("p",[s._v("Character set for the sort order is already in the Syscharsets table.")]),s._v(" "),t("p",[s._v("Finished loading file 'binary.srt'.")]),s._v(" "),t("p",[s._v("1 sort order loaded successfully\n```")]),s._v(" "),t("ul",[t("li",[s._v("修改默认字符集为中文\n首先查一下默认的中文字符集的id"),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sybase_W"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sybase")]),s._v(" utf8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ isql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Usa "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P123456 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("SNP_W\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" sp_helpsort "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--的缺省排序顺序和字符集")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" go\nCollation Name                 Collation ID\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------------------ ------------")]),s._v("\n altdict                                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v("\n")])])])])]),s._v(" "),t("p",[s._v("......中间省略\nSort Order Description")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v(" ------------------------------------------------------------------\n Character Set = 190, utf8\t\t--utf8\n     Unicode 3.1 UTF-8 Character Set\n     Class 2 Character Set\n Sort Order = 45, altdict\t\t--45\n     Alternate (lower-case first) dictionary ordering\n(return status = 0)\n1> sp_configure 'default sortorder id',50\t--需要重启生效，第一次重启会失败，再重启一次\n2> go\n")])])]),t("p",[s._v("1> exit\n[sybase_W@sybase utf8]$\n```")]),s._v(" "),t("ul",[t("li",[s._v("查看数据库信息")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_helpdb        --(查看所有数据库信息)\ngo\n\nsp_helpdb test         --(查看test数据库详细信息)\ngo\n")])])]),t("ul",[t("li",[s._v("查看ASE的远程服务器")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_helpserver\ngo\n")])])]),t("ul",[t("li",[s._v("查看数据库对象的信息")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_helpdevice      --设备信息\nsp_helpdb          --所有数据库的信息\nsp_helptext        --存储过程名字\n\nsp_spaceused         --查看一个当前库(需要use 数据库)或表占所占用的空间\nsp_recompile （+usertable）    --重新编译存储过程和触发器。与该表相关联的存储过程和触发器在第一次运行时，自动重新编译\n")])])]),t("ul",[t("li",[s._v("常用dbcc命令")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("dbcctraceon(3604)                     --(随后的dbcc命令结果输出到屏幕)\ndbcctraceon(3605)                     --(随后的dbcc命令结果输出到错误日志文件)\ndbcccheckalloc[ (database_name[, fix | nofix] ) ]     --(检查分配页)\ndbcccheckcatalog[ (database_name) ]             --(检查系统表)\ndbcccheckdb[ (database_name[, skip_ncindex] ) ]     --(检查数据库)\ndbccchecktable( { table_name| table_id}         --(检查表)\n[, skip_ncindex] )\ndbcctablealloc( { table_name| table_id}         --(检查表分配页)\n[, { full | optimized | fast | null }\n[, fix | nofix] ] ) |\n")])])]),t("ul",[t("li",[s._v("常用系统表")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sysdatabases        --记录所有数据库基本信息\nsysusages        --数据库空间分配情况\nsysdevices        --数据库设备信息\nsyslogins        --数据库服务器登录信息\nsysusers        --数据库用户信息\nsysobjects        --数据库对象表(U 用户表，P 存储过程)\nsysprocesses        --进程表\n")])])]),t("ul",[t("li",[s._v("日常常规维护(性能优化)")]),s._v(" "),t("li",[s._v("更新统计信息")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("update statistics (+usertable)    --不会对表上锁，不影响业务，但比较耗资源 (optdiag)\n")])])]),t("ul",[t("li",[t("p",[s._v("整理数据库垃圾空间\n重建表的聚簇索引\n对行锁表执行reorg\n如何加快上述操作 (配置I/O，并行)\n"),t("strong",[s._v("注意：以上操作对表上锁，另外，必须有足够的空间来执行(剩余空间必须为最大表的1.2倍左右) (sp_spaceusedusertable)")])])]),s._v(" "),t("li",[t("p",[s._v("重新编译存储过程和触发器")])])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_recompile (+usertable)    --与该表相关联的存储过程和触发器在第一次运行时，自动重新编译\n")])])]),t("h3",{attrs:{id:"数据库备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库备份"}},[s._v("#")]),s._v(" 数据库备份")]),s._v(" "),t("p",[s._v("系统管理员每天必须作数据库的备份")]),s._v(" "),t("ul",[t("li",[s._v("备份的命令")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("dump database YWST to '/home/sybase/dump/YWST.dmp'  --此路径为数据库服务器上的真实路径\ngo\n")])])]),t("ul",[t("li",[s._v("恢复的命令")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("load database YWST from '/home/sybase/dump/YWST.dmp'\ngo\n")])])]),t("p",[s._v("可以增加数据设备文件或者扩大已有设备文件的大小")]),s._v(" "),t("h3",{attrs:{id:"日常维护"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日常维护"}},[s._v("#")]),s._v(" 日常维护")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("碎片整理")]),s._v(" "),t("p",[s._v("此操作会锁表，需要每月在空闲时间执行一次")])])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("reorg rebuild 表名\ngo\n")])])]),t("ul",[t("li",[s._v("更新统计值")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("statistics")]),s._v(" T_MS_AJ\ngo\n")])])]),t("h3",{attrs:{id:"常用的存储过程和命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用的存储过程和命令"}},[s._v("#")]),s._v(" 常用的存储过程和命令")]),s._v(" "),t("p",[s._v("以下存储过程可作为日常问题排查用")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sp_who            (查看用户进程)\nsp_lock            (查看数据库锁状况)\nsp_help            (查看对象信息)\nsp_helpdb        (查看数据库信息)\nsp_helpdevice        (查看设备信息)\nsp_spaceused        (查看表占用的空间大小)\nselect @@version    (查看版本号)\ndbcc sqltext(@spid)    (查看@spid执行的sql语句)\nsp_showplan @spid,null,null,null        (查看@spid的执行计划)\n")])])]),t("ul",[t("li",[s._v("sp__getlock")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--sp__getlock，查看数据库当前锁")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" sybsystemprocs\ngo\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" object_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sp__getlock'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" sp__getlock\ngo\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" sp__getlock\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@temp_sql")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sql")]),s._v("          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@unionsql")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@unionsql2")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@dbname")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" dbname_cursor "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("cursor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysdatabases\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@temp_sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' select id as objid,name as objname,db_id(''@dbname'') as dbid from @dbname..sysobjects '")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'select lc.spid as spid,pr.spid as \"进程ID\" , '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' pr.ipaddr as \"IP地址\", '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' pr.program_name as \"应用名称\", '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' pr.cmd AS \"执行命令\", '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' db_name(lc.dbid) as \"数据库名\", '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' obj.objname as \"对象名\", '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' (case when lc.type = 1 then ''排他表锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 2 then ''共享表锁'' '")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 3 then ''排他意向锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 4 then ''共享意图锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 5 then ''排他页锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 6 then ''共享页锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 7 then ''更新页锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 8 then ''排他行锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 9 then ''共享行锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 10 then ''更新行锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 11 then ''共享下一键锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 256 then ''锁阻塞另一进程'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'       when lc.type = 512 then ''请求锁'' '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' end) as \"锁类型名称\", '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' lc.type as \"锁类型\", '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' pr.blocked as \"阻塞进程ID\",'")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' bl.program_name as \"阻塞应用名称\", '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' bl.ipaddr as \"阻塞IP地址\" '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' from master..syslocks lc  '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' left join master..sysprocesses pr on lc.spid = pr.spid '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' left join master..sysprocesses bl on bl.spid = pr.blocked '")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' left join ('")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),s._v(" dbname_cursor\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sqlstatus")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fetch")]),s._v(" dbname_cursor "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@dbname")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@unionsql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@unionsql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" str_replace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@temp_sql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@dbname'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@dbname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@unionsql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@unionsql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'union all'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("close")]),s._v(" dbname_cursor\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deallocate")]),s._v(" dbname_cursor\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@unionsql2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" substring"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@unionsql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("char_length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@unionsql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\t\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@unionsql2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("') obj on lc.id = obj.objid and lc.dbid = obj.dbid'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'select * from ('")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("') t where t.spid !=@@spid'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\ngo\n")])])]),t("ul",[t("li",[s._v("sp__getT50sql")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--sp__getT50sql，查看数据库当前运行sql")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" sybsystemprocs\ngo\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" object_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sp__getT50sql'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v(" \n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" sp__getT50sql\ngo\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" sp__getT50sql\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SPID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipaddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("program_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CpuTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LineNumber"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SQLText\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("\n    master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("monProcessStatement s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("monProcessSQLText t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysprocesses p\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" \n    s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SPID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SPID\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SPID "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spid\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@spid")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" \n    s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CpuTime "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\ngo\n")])])]),t("ul",[t("li",[s._v("sp__addUserGrant")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--sp__addUserGrant，批量给表赋权")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" OBJECT_ID "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dbo.sp__addUserGrant'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" dbo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sp__addUserGrant\nGO\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" sp__addUserGrant\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@userid")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@grant")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@type")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@temp_sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@tabname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" tbname_cursor "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("cursor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" sysobjects  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@type")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@temp_sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'grant '")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@grant")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' on '")]),s._v("     \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),s._v(" tbname_cursor\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sqlstatus")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fetch")]),s._v(" tbname_cursor "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@tabname")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@temp_sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@tabname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" to  "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@userid")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("close")]),s._v(" tbname_cursor\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deallocate")]),s._v(" tbname_cursor\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v(" \nGO\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--- 添加登录账号")]),s._v("\nsp_addlogin newUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'qwer1234'")]),s._v("\nGO\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--- 添加用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" YWST \nGO\nsp_adduser newUser\nGO\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--- 用户赋予权限 注意是用sa分别切换到 DB_ATY/YWST/JCSZ/YYFZ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" YWST\ngo\nsp__addUserGrant newUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Select'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'U'")]),s._v("\nGO\nsp__addUserGrant newUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Select'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'V'")]),s._v("\nGO\nsp__addUserGrant newUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'execute'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'P'")]),s._v("\nGO\n")])])]),t("ul",[t("li",[s._v("sp__getsession")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--sp__getsession，查看当前连接应用名称、ip、连接数量")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" sybsystemprocs\ngo\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" object_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sp__getsession'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" sp__getsession\ngo\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" sp__getsession\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" program_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ipaddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("program_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysprocesses "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" program_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ipaddr "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" program_name\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\ngo\n")])])]),t("ul",[t("li",[s._v("sp__getdbspaceinfo")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--sp__getdbspaceinfo，列出各数据库数据空间、日志空间大小及剩余百分比")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" sybsystemprocs \ngo\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" object_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sp__getdbspaceinfo'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" sp__getdbspaceinfo\ngo\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" sp__getdbspaceinfo\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("convert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("db_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data_segment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"库名"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    str"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total_data_pages "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@maxpagesize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"总数据空间(MB)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    str"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("free_data_pages "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@maxpagesize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"剩余数据空间(MB)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    str"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total_log_pages "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@maxpagesize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"总日志空间(MB)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    str"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("free_log_pages "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@maxpagesize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"剩余日志空间(MB)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    str"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" free_data_pages "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" total_data_pages "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"剩余数据百分比%"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    str"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" free_log_pages "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" total_log_pages"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"剩余日志百分比%"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" dbid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" total_log_pages"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        lct_admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'logsegment_freepages'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dbid "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" free_log_pages\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysusages\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" segmap "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" dbid\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" log_segment\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" dbid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" total_data_pages"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("curunreservedpgs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dbid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" lstart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" unreservedpgs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" free_data_pages\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysusages\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" segmap "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\t\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" dbid \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" data_segment\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" data_segment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" log_segment"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbid \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" str"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" free_data_pages "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" total_data_pages "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("asc")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n\ngo\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);